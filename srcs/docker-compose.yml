services:

  mariadb:
    build: ./requirements/mariadb
    volumes:
      - DB:/var/lib/mysql/
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s

  wordpress:
    # image: php:7-fpm
    depends_on:
      - mariadb
    build: ./requirements/wordpress
    volumes:
      - wpdata:/var/www/html
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s

  nginx:
    depends_on:
      - wordpress
    build: ./requirements/nginx
    volumes:
      - wpdata:/var/www/html
    ports:
      - 443:443
    deploy:
      restart_policy:
        condition: on-failure
        delay: 5s
        max_attempts: 3
        window: 120s
        
volumes:
  DB:
    driver_opts:
      device: /home/asaboure/data/mariadb
      type: 'none'
      o: 'bind'
  wpdata:
    driver_opts:
      device: /home/asaboure/data/wordpress
      type: 'none'
      o: 'bind'

  #nginx: openssl
  #rediriger traffic nginx vers wordpress php (port 9000)
  #lancer nginx avec une option pour quil reste en premier plan

  #wordpress+php: installer tous les php?
  #changer redir vers database + recup les fichiers de config + COPY 

  #database: setup + recup
  #script pour les droits dadmin + exclure root? + ajouter un user 
  #lancer ce script quune fois dans le volume (creer un dossier: sil existe = script deja executÃ©)
  #recup pid sql et wait ?

  #check les droits en cas derreur
  #db: possible probleme de socket --> touch + chmod

  #docker exec -it <container> bash

  #expose port sans le : --> pas acces a lexterieur
  #option dans docker compose pour relancer le container en cas de crash
  #wordpress depends on database (pas lancer la db avant wp)